# The following stanza defines a map named defaults with a variable that may be inserted using the YAML merge (<<: *) key 
# later in the file to save some typing. See http://yaml.org/type/merge.html for details.


version: 2



jobs:
  flow:
    <<: *defaults
    steps:
      - run: npm install ionic
      - run: npm install
      - run: npm run ionic:build -- --prod
      
      # Persist the specified paths (workspace/echo-output) into the workspace for use in downstream job. 
      - persist_to_workspace:
          # Must be an absolute path, or relative path from working_directory. This is a directory on the container which is 
	  # taken to be the root directory of the workspace.
          root: www
          

          
  deploy-job:
      machine:
        enabled: true
      steps:
        - add_ssh_keys:
            fingerprints:
              - "29:8d:e1:c0:c4:e8:84:f8:be:70:f9:47:9b:cc:01:d2"
  downstream:
    <<: *defaults
    machine:
        enabled: true
    steps:
      - attach_workspace:
          # Must be absolute path or relative path from working_directory
          at: /tmp/www

      - run: 
          name: Deploy Over SSH
          command: 
            - ssh -o "StrictHostKeyChecking no" ddh_vz96se@belezapro.services4you.com.br "cd ~/beleza_profissional ; scp -r * $SSH_USER@$SSH_HOST:/belezapro.services4you.com.br"

workflows:
  version: 2

  btd:
    jobs:
      - flow
      - downstream:
          requires:
            - flow